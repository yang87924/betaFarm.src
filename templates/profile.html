{% extends 'base/base.html' %} 

{% block page_title %}個人資料維護{% endblock %}

{% block page_content %}
<div class="row">
  <div class="col-sm-6 col-xs-12 col-sm-offset-3">
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">修改密碼</h3>
      </div>
      <!-- form start -->
        <div class="box-body">
          <div class="form-group">
            <label for="oldpwd" class="">舊密碼</label>
            <input type="password" class="form-control" placeholder="舊密碼" id="oldpwd" required>
	        </div>
        <div class="form-group">
	    <label for="newpwd"  class="">新密碼</label>
	    <input type="password" class="form-control" placeholder="新密碼" id="newpwd" required>
	  </div>
          <div class="form-group">
	    <label for="repnewpwd" class="">再次輸入新密碼</label>
	    <input type="password" class="form-control" placeholder="再次輸入新密碼" id="repnewpwd" required>
	  </div>
        </div>
        <!-- /.box-body -->
        <div class="box-footer">
          <button class="btn btn-primary" onclick="mysubmit()">確定更改</button>
        </div>
    </div>
  </div>
  <!-- /.col -->
</div>

{% endblock %}

{% block page_script %}
<!-- Page script -->
<script>
  function validate() {
    if ($('#newpwd').val() != $('#repnewpwd').val()) {
      $('#repnewpwd')[0].setCustomValidity("密碼不符合");
      return false;
    } else {
      $('#repnewpwd')[0].setCustomValidity("");
      return true;
    }
  }

  function mysubmit() {
    if (!validate()) {
      return;
    }
  
    axios.post('/api/user/pwd',
               {'old_password': $('#oldpwd').val(),
                'new_password': $('#newpwd').val()})
          .then((data, status, request) => {
            Swal.fire({
                icon: 'success',
                title: "密碼變更"
            }).then(()=>{
              window.location.reload();
            })
            location.reload();
         }).catch((error) => {
              Swal.fire({
                icon: 'error',
                title: "密碼錯誤"
            })
          });
  }
  $(()=>{
    $('#newpwd').keyup(validate);
    $('#repnewpwd').keyup(validate);
  })
</script>
{% endblock %}
